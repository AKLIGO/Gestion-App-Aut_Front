<!-- Hero Section -->
<section 
  class="relative h-screen w-full bg-cover bg-center flex items-center justify-center transition-all duration-1000 ease-in-out"
  [style.background-image]="images.length ? 'url(' + images[currentImageIndex] + ')' : ''"
>
  <div class="absolute inset-0 bg-black bg-opacity-50"></div>

  <div class="relative text-center text-white px-4">
    <h1 class="text-5xl md:text-6xl font-bold mb-4 animate-fadeIn">Trouvez votre location idéale</h1>
    <p class="text-xl md:text-2xl mb-8 animate-fadeIn">Appartements et véhicules à louer en quelques clics</p>
    <a href="#offres" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-300 animate-fadeIn">
      Découvrir nos offres
    </a>
  </div>
</section>

<!-- Offres Section -->
<section id="offres" class="py-16 px-4 bg-gray-100">
  <h2 class="text-3xl font-bold text-center mb-12">Nos offres</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    
    <!-- Carte Appartement -->
    <div *ngFor="let appart of pagedAppartements; trackBy: trackByAppartementId" class="bg-white shadow-lg rounded-lg overflow-hidden">
      
      <!-- Image Appartement -->
      <img [src]="appart.images?.[0]?.previewUrl || 'https://via.placeholder.com/400x200'" 
           [alt]="appart.nom" 
           class="w-full h-48 object-cover">

      <div class="p-4">
        <h3 class="font-bold text-xl mb-2">{{ appart.nom }}</h3>
        <p class="text-gray-600 mb-2">{{ appart.adresse }} | Pièces: {{ appart.nbrDePieces }}</p>
        <p class="text-gray-800 mb-2 font-semibold">Prix: {{ appart.prix | currency:'XOF' }}</p>

        <div class="flex flex-wrap gap-2 mb-2">
          <span class="inline-block px-2 py-1 text-xs rounded"
                [ngClass]="{
                  'bg-green-500 text-white': appart.statut === StatutAppartement.DISPONIBLE,
                  'bg-gray-400 text-white': appart.statut !== StatutAppartement.DISPONIBLE
                }">{{ appart.statut }}</span>

          <span class="inline-block px-2 py-1 text-xs rounded bg-blue-200 text-blue-800">{{ appart.type }}</span>
        </div>

        <!-- Boutons et formulaire -->
        <div class="flex flex-col gap-2">
          <button class="w-full px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded" (click)="openDetails(appart)">
            Détails
          </button>
          
          <button class="w-full px-4 py-2 border border-gray-200 rounded hover:bg-gray-50 text-gray-700" (click)="showReservationForm(appart)">
            Réserver
          </button>

          <!-- Formulaire de réservation -->
          <div *ngIf="selectedAppartementForReservation?.id === appart.id" class="mt-2 p-4 border border-gray-200 rounded bg-gray-50">
            <label class="block mb-2">
              Date Début
              <input type="date" [(ngModel)]="reservationForm.dateDebut" class="w-full border rounded px-2 py-1" />
            </label>
            <label class="block mb-2">
              Date Fin
              <input type="date" [(ngModel)]="reservationForm.dateFin" class="w-full border rounded px-2 py-1" />
            </label>
            <button class="mt-2 w-full px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700"
                    (click)="submitReservation(appart)">
              Confirmer la réservation
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="mt-8 flex justify-center gap-2">
    <button class="px-3 py-1 bg-gray-300 rounded disabled:opacity-50" (click)="changePage(currentPage -1)" [disabled]="currentPage===1">Précédent</button>
    <button *ngFor="let page of [].constructor(totalPages); let i=index"
            class="px-3 py-1 rounded" 
            [ngClass]="{'bg-indigo-600 text-white': currentPage===i+1, 'bg-gray-200': currentPage!==i+1}"
            (click)="changePage(i+1)">{{ i+1 }}</button>
    <button class="px-3 py-1 bg-gray-300 rounded disabled:opacity-50" (click)="changePage(currentPage +1)" [disabled]="currentPage===totalPages">Suivant</button>
  </div>
</section>

<!-- Modal Détails -->
<div *ngIf="selectedAppartement" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
  <div class="bg-white w-full max-w-2xl rounded-lg overflow-hidden shadow-lg max-h-[90vh] overflow-y-auto">

    
    <!-- Images -->
    <div class="p-4 space-y-4">
      <ng-container *ngIf="(selectedAppartement.images ?? []).length > 0; else noImages">
        <div class="relative">
          <img [src]="getImageUrl(selectedAppartement.images[selectedImageIndex])"
               class="w-full h-52 object-cover rounded-md"
               [alt]="selectedAppartement.nom ?? 'image'">

          <button *ngIf="(selectedAppartement.images?.length ?? 0) > 1"
                  (click)="prevImage()"
                  class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-60 hover:bg-opacity-80 rounded-full p-2">‹</button>

          <button *ngIf="(selectedAppartement.images?.length ?? 0) > 1"
                  (click)="nextImage()"
                  class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-60 hover:bg-opacity-80 rounded-full p-2">›</button>

          <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-40 text-white text-sm px-2 py-1 rounded">
            {{ selectedImageIndex + 1 }} / {{ selectedAppartement.images.length }}
          </div>
        </div>
      </ng-container>
      <ng-template #noImages>
        <div class="p-8 bg-gray-200 text-center rounded">Aucune image disponible</div>
      </ng-template>
    </div>

    <!-- Infos et actions -->
    <div class="p-6 border-t bg-gray-50">
      <div class="flex flex-col md:flex-row md:items-start md:gap-6">
        <div class="flex-1">
          <h3 class="text-2xl font-extrabold text-gray-800 mb-2">{{ selectedAppartement.nom }}</h3>
          <p class="text-sm text-gray-500 mb-4 flex items-center gap-2">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1 1 0 01-1.414 0l-4.243-4.243A8 8 0 1117.657 16.657z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            <span>{{ selectedAppartement.adresse }}</span>
          </p>

          <div class="grid grid-cols-2 gap-3 text-sm mb-4">
            <div class="bg-white p-3 rounded shadow-sm">
              <div class="text-xs text-gray-400">Superficie</div>
              <div class="font-medium text-gray-800">{{ selectedAppartement.superficie }} m²</div>
            </div>
            <div class="bg-white p-3 rounded shadow-sm">
              <div class="text-xs text-gray-400">Pièces</div>
              <div class="font-medium text-gray-800">{{ selectedAppartement.nbrDePieces }}</div>
            </div>
            <div class="bg-white p-3 rounded shadow-sm">
              <div class="text-xs text-gray-400">Type</div>
              <div class="font-medium text-gray-800">{{ selectedAppartement.type }}</div>
            </div>
            <div class="bg-white p-3 rounded shadow-sm">
              <div class="text-xs text-gray-400">Statut</div>
              <div class="font-medium"
                   [ngClass]="{
                     'text-green-600': selectedAppartement.statut === StatutAppartement.DISPONIBLE,
                     'text-gray-600': selectedAppartement.statut !== StatutAppartement.DISPONIBLE
                   }">{{ selectedAppartement.statut }}</div>
            </div>
          </div>

          <div class="mt-2">
            <div class="text-sm text-gray-400">Prix</div>
            <div class="text-2xl font-bold text-indigo-600 mb-3">{{ selectedAppartement.prix | currency:'XOF' }}</div>
            <div *ngIf="selectedAppartement.description" class="prose prose-sm max-w-none text-gray-700 bg-white p-4 rounded shadow-sm">
              {{ selectedAppartement.description }}
            </div>
          </div>
        </div>

        <div class="mt-4 md:mt-0 md:w-44 flex-shrink-0">
          <div class="flex flex-col gap-3">
            <button class="w-full px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded shadow">Contacter</button>
            <div class="text-xs text-gray-400 pt-2">Référence: <span class="text-gray-700 font-medium">{{ selectedAppartement.numero }}</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="p-4 border-t text-right bg-white">
      <button class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 mr-2" (click)="closeDetails()">Fermer</button>
      <button class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Voir sur la carte</button>
    </div>
  </div>
</div>
